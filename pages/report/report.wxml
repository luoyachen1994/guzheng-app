<!--pages/report/report.wxml-->
<view class="container safe-bottom">
  <!-- æ€»ä½“è¯„åˆ† -->
  <view class="score-header">
    <view class="score-circle">
      <text class="total-score">{{report.totalScore || '--'}}</text>
      <text class="score-max">/100</text>
    </view>
    <text class="score-level">{{report.level || 'ç­‰å¾…åˆ†æ'}}</text>
    <text class="score-date">{{report.date || ''}}</text>
  </view>

  <!-- ç»´åº¦è¯„åˆ† -->
  <view class="card dimension-card" wx:if="{{report.dimensions}}">
    <text class="section-title">å„ç»´åº¦è¯„åˆ†</text>
    <view class="dimension-list">
      <view class="dimension-item" wx:for="{{report.dimensions}}" wx:key="name">
        <view class="flex-between">
          <text class="dim-name">{{item.name}}</text>
          <text class="dim-score">{{item.score}}</text>
        </view>
        <view class="progress-bar">
          <view
            class="progress-fill {{item.score >= 80 ? 'good' : item.score >= 60 ? 'fair' : 'poor'}}"
            style="width: {{item.score}}%;"
          ></view>
        </view>
      </view>
    </view>
  </view>

  <!-- æ‰‹å‹åˆ†æï¼ˆè§†é¢‘æ¨¡å¼ï¼‰ -->
  <view class="card" wx:if="{{report.handAnalysis}}">
    <text class="section-title">æ‰‹å‹åˆ†æ</text>
    <view class="analysis-section">
      <view class="analysis-item" wx:for="{{report.handAnalysis.issues}}" wx:key="index">
        <view class="issue-header">
          <text class="issue-icon {{item.severity}}">{{item.severity === 'warning' ? 'âš ï¸' : 'ğŸ’¡'}}</text>
          <text class="issue-title">{{item.title}}</text>
        </view>
        <text class="issue-desc">{{item.description}}</text>
        <text class="issue-suggestion">å»ºè®®ï¼š{{item.suggestion}}</text>
      </view>
    </view>
  </view>

  <!-- éŸ³é¢‘åˆ†æ -->
  <view class="card" wx:if="{{report.audioAnalysis}}">
    <text class="section-title">éŸ³å‡†ä¸èŠ‚å¥</text>

    <!-- éŸ³å‡†å›¾è¡¨å ä½ -->
    <view class="chart-placeholder">
      <canvas canvas-id="reportPitchCanvas" class="report-chart"></canvas>
    </view>

    <view class="analysis-section">
      <view class="analysis-item" wx:for="{{report.audioAnalysis.issues}}" wx:key="index">
        <view class="issue-header">
          <text class="issue-icon {{item.severity}}">{{item.severity === 'warning' ? 'âš ï¸' : 'ğŸ’¡'}}</text>
          <text class="issue-title">{{item.title}}</text>
        </view>
        <text class="issue-desc">{{item.description}}</text>
        <text class="issue-suggestion">å»ºè®®ï¼š{{item.suggestion}}</text>
      </view>
    </view>
  </view>

  <!-- AI ç»¼åˆå»ºè®® -->
  <view class="card advice-card" wx:if="{{report.advice}}">
    <text class="section-title">AI ç»ƒä¹ å»ºè®®</text>
    <view class="advice-list">
      <view class="advice-item" wx:for="{{report.advice}}" wx:key="index">
        <text class="advice-number">{{index + 1}}</text>
        <text class="advice-text">{{item}}</text>
      </view>
    </view>
  </view>

  <!-- æ“ä½œæŒ‰é’® -->
  <view class="action-buttons">
    <button class="btn-secondary" bindtap="sharReport">åˆ†äº«æŠ¥å‘Š</button>
    <button class="btn-primary" bindtap="practiceAgain">å†ç»ƒä¸€æ¬¡</button>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{!report.totalScore}}">
    <text class="empty-icon">ğŸ“Š</text>
    <text class="empty-text">æš‚æ— ç»ƒä¹ æŠ¥å‘Š</text>
    <button class="btn-primary" style="margin-top: 32rpx;" bindtap="practiceAgain">å¼€å§‹ç»ƒä¹ </button>
  </view>
</view>
